{
  "meta": {
    "project_name": "Indica Aí – Social Recommendations MVP",
    "project_type": "frontend",
    "phase": "tech",
    "version": "0.2.0",
    "last_updated": "2026-01-18"
  },
  "stack": {
    "runtime": "Node.js (for tooling/dev server)",
    "framework": "Next.js (App Router)",
    "language": "TypeScript",
    "ui_library": "React",
    "styling": "Tailwind CSS",
    "state_management": "React Query / TanStack Query for server state; local component state for UI",
    "forms": "React Hook Form or lightweight controlled components",
    "bundling": "Next.js built-in (Turbopack)",
    "testing": "Vitest / Jest + React Testing Library (optional for MVP)",
    "backend": "Supabase (Auth, Database, Storage)",
    "i18n": "next-intl"
  },
  "supabase": {
    "description": "Supabase provides the complete backend infrastructure for the MVP",
    "services": {
      "auth": {
        "description": "Authentication and user management",
        "providers": ["Google OAuth", "Email/Password"],
        "features": ["Session management", "JWT tokens", "User metadata"]
      },
      "database": {
        "description": "PostgreSQL database with Row Level Security",
        "tables": ["users", "places", "experiences", "bookmarks"],
        "features": ["RLS policies", "Foreign key relationships", "Indexes"]
      },
      "storage": {
        "description": "File storage for user uploads",
        "buckets": ["experience-images", "avatars"],
        "features": ["Public/private buckets", "Image transformations"]
      }
    },
    "packages": {
      "@supabase/supabase-js": "Core Supabase client",
      "@supabase/ssr": "Server-side rendering utilities for Next.js"
    },
    "environment_variables": {
      "NEXT_PUBLIC_SUPABASE_URL": "Supabase project URL",
      "NEXT_PUBLIC_SUPABASE_ANON_KEY": "Supabase anonymous/public key",
      "SUPABASE_SERVICE_ROLE_KEY": "Server-side only, for admin operations"
    },
    "client_utilities": {
      "lib/supabase/client.ts": "Browser client (createBrowserClient)",
      "lib/supabase/server.ts": "Server client for API routes (createServerClient)",
      "lib/supabase/middleware.ts": "Middleware client for auth checks"
    }
  },
  "architecture": {
    "structure": {
      "suggested_folders": [
        "app/[locale]/ (routes with i18n)",
        "app/api/ (API routes)",
        "components/ (shared UI)",
        "features/auth/",
        "features/feed/",
        "features/add/",
        "features/profile/",
        "features/experience-detail/",
        "lib/supabase/ (Supabase clients)",
        "lib/api/ (API utilities)",
        "lib/models/",
        "lib/hooks/",
        "lib/utils/",
        "locales/ (i18n messages)"
      ]
    },
    "principles": [
      "Feature-first folders (feed, add, profile, auth) instead of huge global components folder.",
      "Use Supabase client directly in React Query hooks or API routes.",
      "Use domain types from lib/models mirroring Supabase database schema.",
      "Avoid unnecessary global state; use React Query for data fetching/caching.",
      "RLS policies enforce data access at the database level.",
      "API routes are thin wrappers for complex operations or server-side logic."
    ]
  },
  "integration": {
    "NEXT_PUBLIC_SUPABASE_URL": "Configured via env var NEXT_PUBLIC_SUPABASE_URL",
    "NEXT_PUBLIC_SUPABASE_ANON_KEY": "Configured via env var NEXT_PUBLIC_SUPABASE_ANON_KEY",
    "contracts": [
      "Use TypeScript types that match Supabase database schema exactly.",
      "Handle loading, error, and empty states explicitly.",
      "Never send google_maps_url from frontend; compute server-side or via database function.",
      "All authenticated requests include Supabase session automatically."
    ],
    "location_behaviors": {
      "gps": "Use Geolocation API only when starting Quick Add; handle permission denied gracefully.",
      "ip_fallback": "Use IP geolocation service (e.g., ipapi, ipinfo).",
      "manual_city": "Show CitySelector component when neither GPS nor IP works."
    },
    "place_deduplication": {
      "description": "Places are deduplicated to allow multiple users to recommend the same place. This enables recommendation counts and shared place data.",
      "google_places": "Deduplicated by google_place_id. If a place with the same google_place_id exists, the existing place is returned.",
      "manual_places": "Deduplicated by case-insensitive match on name + city + country. Custom places (custom=true) are checked for duplicates.",
      "recommendation_count": "The count of experiences referencing a place. Displayed in search results, feed cards, and experience details.",
      "existing_place_modal": "When selecting a place with existing recommendations during Quick Add, a modal shows the recommendation count and top tags, allowing the user to either add their experience to the existing place or create a new one."
    }
  },
  "domain_models_frontend": {
    "types": {
      "User": {
        "id": "string (UUID)",
        "display_name": "string",
        "username": "string",
        "avatar_url": "string | null",
        "created_at": "string"
      },
      "AuthUser": {
        "id": "string (UUID, from Supabase auth.users)",
        "email": "string",
        "display_name": "string",
        "username": "string",
        "avatar_url": "string | null",
        "provider": "'google' | 'email'",
        "created_at": "string"
      },
      "Place": {
        "id": "string (UUID)",
        "google_place_id": "string | null",
        "name": "string",
        "city": "string",
        "country": "string",
        "address": "string | null",
        "lat": "number | null",
        "lng": "number | null",
        "instagram_handle": "string | null",
        "google_maps_url": "string | null",
        "custom": "boolean",
        "recommendation_count": "number | undefined (count of experiences for this place)",
        "created_at": "string"
      },
      "PlaceStats": {
        "recommendation_count": "number",
        "top_tags": "string[] (most common tags for this place)"
      },
      "PlaceSearchResult": {
        "extends": "Place",
        "id": "string | null (null for Google Places not yet saved)",
        "source": "'local' | 'google'",
        "recommendation_count": "number | undefined"
      },
      "Experience": {
        "id": "string (UUID)",
        "user_id": "string (UUID)",
        "place_id": "string (UUID)",
        "price_range": "'$' | '$$' | '$$$' | '$$$$'",
        "tags": "string[]",
        "brief_description": "string | null",
        "phone_number": "string | null",
        "images": "string[] | null",
        "visit_date": "string | null",
        "created_at": "string"
      },
      "ExperienceFeedItem": {
        "id": "string",
        "experience_id": "string",
        "user": {
          "id": "string",
          "display_name": "string",
          "avatar_url": "string | null"
        },
        "place": {
          "id": "string",
          "name": "string",
          "city_short": "string",
          "country": "string",
          "thumbnail_image_url": "string | null",
          "instagram": "string | null",
          "recommendation_count": "number | undefined"
        },
        "price_range": "'$' | '$$' | '$$$' | '$$$$'",
        "tags": "string[]",
        "time_ago": "string",
        "description": "string | null"
      },
      "Bookmark": {
        "id": "string (UUID)",
        "user_id": "string (UUID)",
        "experience_id": "string (UUID)",
        "created_at": "string"
      }
    },
    "view_models": {
      "ExperienceCardProps": {
        "experience": "ExperienceFeedItem",
        "onClick": "() => void",
        "onBookmarkToggle?": "() => void"
      },
      "QuickAddFormState": {
        "step": "'location_search' | 'select_place' | 'enrich' | 'review'",
        "place": "Place | null",
        "price_range": "'$' | '$$' | '$$$' | '$$$$' | null",
        "tags": "string[]",
        "instagram_handle": "string",
        "brief_description": "string",
        "phone_number": "string",
        "images": "File[] | string[]",
        "visit_date": "string | null"
      }
    }
  },
  "database_schema": {
    "description": "Supabase PostgreSQL tables (defined in Supabase dashboard or migrations)",
    "tables": {
      "users": {
        "description": "User profiles, extends auth.users",
        "columns": {
          "id": "UUID PRIMARY KEY REFERENCES auth.users(id)",
          "display_name": "TEXT NOT NULL",
          "username": "TEXT UNIQUE NOT NULL",
          "avatar_url": "TEXT",
          "created_at": "TIMESTAMPTZ DEFAULT NOW()"
        },
        "rls_policies": [
          "Users can read any profile",
          "Users can only update their own profile"
        ]
      },
      "places": {
        "description": "Places/locations",
        "columns": {
          "id": "UUID PRIMARY KEY DEFAULT gen_random_uuid()",
          "google_place_id": "TEXT",
          "name": "TEXT NOT NULL",
          "city": "TEXT NOT NULL",
          "country": "TEXT NOT NULL",
          "address": "TEXT",
          "lat": "DECIMAL",
          "lng": "DECIMAL",
          "instagram_handle": "TEXT",
          "google_maps_url": "TEXT",
          "custom": "BOOLEAN DEFAULT false",
          "created_at": "TIMESTAMPTZ DEFAULT NOW()"
        },
        "rls_policies": [
          "Anyone can read places",
          "Authenticated users can create places"
        ]
      },
      "experiences": {
        "description": "User experiences at places",
        "columns": {
          "id": "UUID PRIMARY KEY DEFAULT gen_random_uuid()",
          "user_id": "UUID REFERENCES users(id) NOT NULL",
          "place_id": "UUID REFERENCES places(id) NOT NULL",
          "price_range": "TEXT CHECK (price_range IN ('$', '$$', '$$$', '$$$$'))",
          "tags": "TEXT[]",
          "brief_description": "TEXT",
          "phone_number": "TEXT",
          "images": "TEXT[]",
          "visit_date": "DATE",
          "created_at": "TIMESTAMPTZ DEFAULT NOW()"
        },
        "rls_policies": [
          "Anyone can read experiences",
          "Users can only create/update/delete their own experiences"
        ]
      },
      "bookmarks": {
        "description": "User bookmarks on experiences",
        "columns": {
          "id": "UUID PRIMARY KEY DEFAULT gen_random_uuid()",
          "user_id": "UUID REFERENCES users(id) NOT NULL",
          "experience_id": "UUID REFERENCES experiences(id) NOT NULL",
          "created_at": "TIMESTAMPTZ DEFAULT NOW()"
        },
        "constraints": ["UNIQUE(user_id, experience_id)"],
        "rls_policies": [
          "Users can only see their own bookmarks",
          "Users can only create/delete their own bookmarks"
        ]
      }
    }
  },
  "ui_components": {
    "global": [
      "DesktopNav",
      "BottomNav",
      "TopBar",
      "Avatar",
      "Chip",
      "Button",
      "Input",
      "TextArea",
      "IconButton",
      "LoadingSpinner",
      "ErrorMessage"
    ],
    "features": {
      "auth": [
        "SignInForm",
        "SignUpForm",
        "AuthGuard",
        "UserMenu"
      ],
      "feed": [
        "ExperienceCard",
        "ExperienceList",
        "SectionHeader",
        "FeedEmptyState"
      ],
      "quick_add": [
        "QuickAddLayout",
        "PlaceSearchInput",
        "PlaceSuggestionList",
        "CustomPlaceForm",
        "PriceRangeSelector",
        "TagSelector",
        "AdditionalFieldsPanel",
        "SaveExperienceButton",
        "ExistingPlaceModal"
      ],
      "profile": [
        "UserHeader",
        "ProfileTabs",
        "ProfileExperienceList",
        "ProfileBookmarksPlaceholder"
      ],
      "experience_detail": [
        "ExperienceDetailLayout",
        "ImageGallery",
        "MapLinkButton",
        "BookmarkButton",
        "MoreFromUser"
      ]
    }
  },
  "api_routes": {
    "places": {
      "POST /api/places": "Create a new place. Deduplicates by google_place_id for Google Places, or by name+city+country for manual entries. Returns recommendation_count.",
      "GET /api/places/search": "Search places locally and via Google Places API. Returns recommendation_count for local results.",
      "GET /api/places/match": "Find matching places by name/city/country for manual deduplication. Returns exact_match and similar_matches with recommendation counts.",
      "GET /api/places/[id]/stats": "Get place statistics: recommendation_count and top_tags (most common tags)."
    },
    "experiences": {
      "POST /api/experiences": "Create a new experience.",
      "GET /api/experiences/[id]": "Get experience details with recommendation_count for the place."
    },
    "feed": {
      "GET /api/feed": "Get feed with mySuggestions, communitySuggestions, nearbyPlaces. All include recommendation_count per place."
    }
  },
  "hooks": {
    "auth": [
      "useAuth() - Get current authenticated user",
      "useSession() - Get Supabase session"
    ],
    "data": [
      "useFeed() - Fetch feed experiences",
      "useExperience(id) - Fetch single experience",
      "useProfile(userId) - Fetch user profile",
      "useCreateExperience() - Create new experience mutation",
      "useToggleBookmark() - Toggle bookmark mutation"
    ]
  },
  "non_functional": {
    "performance": [
      "Use React Suspense or skeletons for loading states.",
      "Avoid unnecessary re-renders; memoize heavy lists/cards where needed.",
      "Use Supabase realtime sparingly (only where needed)."
    ],
    "security": [
      "Never expose SUPABASE_SERVICE_ROLE_KEY to the client.",
      "Use RLS policies for all data access.",
      "Validate user input on both client and server.",
      "Use httpOnly cookies for session storage (via @supabase/ssr)."
    ],
    "accessibility": [
      "All interactive elements must have visible focus states.",
      "Navigation buttons must have aria-labels and role='navigation'.",
      "Ensure color contrast meets AA using provided design_tokens.",
      "Minimum 44px touch targets."
    ],
    "responsiveness": [
      "Target common breakpoints: 320–414px (mobile), ~768px (tablet), 1024+ (desktop).",
      "Max-width container on desktop (1760px)."
    ]
  }
}
